/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Kotlin application project to get you started.
 */

plugins {
    // Apply the Kotlin JVM plugin to add support for Kotlin.
    id 'org.jetbrains.kotlin.jvm' version '1.3.71'

    id "org.jetbrains.kotlin.plugin.spring" version "1.3.71"

    id "org.jetbrains.kotlin.plugin.noarg" version "1.3.71"

    id 'org.springframework.boot' version '2.2.6.RELEASE'

    id 'org.liquibase.gradle' version '2.0.2'
}

repositories {
    jcenter()
    mavenCentral()
}

def props = new Properties()
file("src/main/resources/application.properties").withInputStream { props.load(it) }

dependencies {
    // Align versions of all Kotlin components
    implementation platform('org.jetbrains.kotlin:kotlin-bom')

    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-webflux', version: '2.2.6.RELEASE'

    // Use the Kotlin JDK 8 standard library.
    implementation group: 'org.jetbrains.kotlin', name: 'kotlin-stdlib-jdk8'

    implementation group: 'com.fasterxml.jackson.module', name: 'jackson-module-kotlin', version: '2.11.0.rc1'

    implementation group: 'org.springframework.data', name: 'spring-data-r2dbc', version: '1.0.0.RELEASE'

    implementation "io.projectreactor.kotlin:reactor-kotlin-extensions:1.0.2.RELEASE"

    implementation group: 'io.r2dbc', name: 'r2dbc-postgresql', version: '0.8.2.RELEASE'

    liquibaseRuntime 'org.liquibase:liquibase-core:3.8.1'

    liquibaseRuntime 'org.liquibase:liquibase-groovy-dsl:2.0.1'

    liquibaseRuntime 'org.postgresql:postgresql:42.2.11'

    liquibaseRuntime "jakarta.xml.bind:jakarta.xml.bind-api:2.3.2"


    // Use the Kotlin test library.
    testImplementation group: 'org.jetbrains.kotlin', name: 'kotlin-test'

    // Use the Kotlin JUnit integration.
    testImplementation group: 'org.jetbrains.kotlin', name: 'kotlin-test-junit'
}

compileKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
        freeCompilerArgs = ["-Xjsr305=strict"]
    }

}
compileTestKotlin {
    kotlinOptions {
        jvmTarget = "1.8"
        freeCompilerArgs = ["-Xjsr305=strict"]
    }
}

liquibase {
    activities {
        main {
            changeLogFile 'src/main/resources/liquibase/myChangeLog.xml'
            url "jdbc:${props.getProperty("db.url")}"
            username "${props.getProperty("spring.r2dbc.username")}"
            password "${props.getProperty("spring.r2dbc.password")}"
        }
    }
}



